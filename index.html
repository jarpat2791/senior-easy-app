<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <meta name="description" content="Senior-Easy - Aplikacja dla senior√≥w u≈ÇatwiajƒÖca kontakt z rodzinƒÖ i zarzƒÖdzanie lekami" />
  <meta name="theme-color" content="#3B82F6" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Senior-Easy" />
  
  <title>Senior-Easy App</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json" />
  
  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    *{box-sizing:border-box}
    .rounded-3xl{border-radius:1.5rem}
    .rounded-2xl{border-radius:1rem}
    html,body{margin:0;padding:0;width:100%;height:100%;overflow-x:hidden;overscroll-behavior-y:contain;-webkit-tap-highlight-color:transparent;touch-action:manipulation}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif}
    *{-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}
    input,textarea,select{-webkit-user-select:text;user-select:text}
    button{cursor:pointer;-webkit-tap-highlight-color:rgba(0,0,0,.1)}
    .install-prompt{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);z-index:1000;animation:slideUp .3s ease-out;max-width:calc(100vw - 32px)}
    @keyframes slideUp{from{transform:translate(-50%,100px);opacity:0}to{transform:translate(-50%,0);opacity:1}}
    #root{min-height:100vh;width:100%}
    
    /* Styl przycisku awaryjnego */
    .emergency-button {
      position: fixed;
      bottom: 100px;
      right: 20px;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: linear-gradient(to bottom, #ff3333, #cc0000);
      box-shadow: 0 4px 15px rgba(255, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      font-weight: bold;
      z-index: 100;
      border: 3px solid white;
      animation: pulse 2s infinite;
      transition: all 0.3s ease;
    }
    
    .emergency-button:active {
      transform: scale(0.9);
      box-shadow: 0 2px 8px rgba(255, 0, 0, 0.7);
    }
    
    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7);
      }
      70% {
        box-shadow: 0 0 0 15px rgba(255, 0, 0, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(255, 0, 0, 0);
      }
    }
    
    /* Styl okna dialogowego awaryjnego */
    .emergency-dialog {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    
    .emergency-content {
      background: white;
      border-radius: 20px;
      padding: 20px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    
    .emergency-option {
      display: flex;
      align-items: center;
      padding: 15px;
      margin: 10px 0;
      border-radius: 10px;
      background: #f5f5f5;
      transition: background 0.3s;
    }
    
    .emergency-option:active {
      background: #e0e0e0;
    }
    
    .emergency-icon {
      font-size: 30px;
      margin-right: 15px;
    }
    
    .emergency-text {
      flex: 1;
      text-align: left;
    }
    
    .emergency-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .emergency-description {
      font-size: 14px;
      color: #666;
    }

    /* Styl dla edycji telefon√≥w */
    .phone-list {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #e5e5e5;
      border-radius: 10px;
      padding: 10px;
      margin-top: 10px;
    }
    
    .phone-item {
      display: flex;
      justify-content: between;
      align-items: center;
      padding: 8px;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .phone-item:last-child {
      border-bottom: none;
    }
    
    .phone-number {
      flex: 1;
      font-family: monospace;
    }
    
    .tab-button {
      padding: 10px 15px;
      border: none;
      background: #f0f0f0;
      border-radius: 5px;
      margin-right: 5px;
      cursor: pointer;
    }
    
    .tab-button.active {
      background: #3B82F6;
      color: white;
    }

    /* Styl dla dni tygodnia */
    .weekday-button {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 2px;
      border: 2px solid #e5e5e5;
      background: white;
      font-weight: bold;
    }
    
    .weekday-button.selected {
      background: #3B82F6;
      color: white;
      border-color: #3B82F6;
    }

    .weekday-button:active {
      transform: scale(0.95);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-purple-100">
  <div id="root" class="p-2 sm:p-4 max-w-4xl mx-auto pb-20 min-h-screen"></div>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function SeniorEasyApp() {
      const [currentScreen, setCurrentScreen] = useState('home');
      const [medications, setMedications] = useState([]);
      const [familyContacts, setFamilyContacts] = useState([]);
      const [localServices, setLocalServices] = useState([]);
      const [notifications, setNotifications] = useState([]);
      const [careMode, setCareMode] = useState(true);
      const [showInstallPrompt, setShowInstallPrompt] = useState(false);
      const [deferredPrompt, setDeferredPrompt] = useState(null);
      const [showNotifyDialog, setShowNotifyDialog] = useState(false);
      const [selectedMedication, setSelectedMedication] = useState(null);
      const [showEmergencyDialog, setShowEmergencyDialog] = useState(false);
      const [showEmergencySettings, setShowEmergencySettings] = useState(false);
      const [emergencySettingsTab, setEmergencySettingsTab] = useState('appearance');

      const [newMedName, setNewMedName] = useState('');
      const [newMedTime, setNewMedTime] = useState('');
      const [newMedDays, setNewMedDays] = useState([]);
      const [newContactName, setNewContactName] = useState('');
      const [newContactPhone, setNewContactPhone] = useState('');
      const [newContactApp, setNewContactApp] = useState('');
      const [newServiceName, setNewServiceName] = useState('');
      const [newServicePhone, setNewServicePhone] = useState('');
      const [newServiceIcon, setNewServiceIcon] = useState('');
      const [editingContact, setEditingContact] = useState(null);
      const [editingService, setEditingService] = useState(null);
      const [editingMedication, setEditingMedication] = useState(null);

      // Ustawienia przycisku awaryjnego
      const [emergencySettings, setEmergencySettings] = useState({
        enabled: true,
        position: 'bottom-right',
        size: 70,
        color: 'red',
        pulse: true,
        familyMessage: 'üö® PILNA WIADOMO≈öƒÜ! Potrzebujƒô pomocy! Proszƒô o kontakt.',
        medicalMessage: 'üö® PILNA WIADOMO≈öƒÜ! Potrzebujƒô pomocy medycznej! Proszƒô o natychmiastowy kontakt.',
        servicesMessage: 'üö® PILNA WIADOMO≈öƒÜ! Potrzebujƒô pomocy! Proszƒô o kontakt.',
        // Nowe ustawienia telefon√≥w
        familyPhones: [],
        medicalPhones: ['112', '999'],
        servicesPhones: ['997', '998']
      });

      // Stan dla edycji telefon√≥w
      const [newPhoneNumber, setNewPhoneNumber] = useState('');
      const [editingPhoneType, setEditingPhoneType] = useState('family');

      // Dni tygodnia
      const weekdays = ['Pon', 'Wt', '≈ör', 'Czw', 'Pt', 'Sb', 'Nd'];

      useEffect(() => {
        const savedMeds = localStorage.getItem('medications');
        const savedContacts = localStorage.getItem('familyContacts');
        const savedServices = localStorage.getItem('localServices');
        const savedEmergencySettings = localStorage.getItem('emergencySettings');
        
        setMedications(savedMeds ? JSON.parse(savedMeds) : [
          {id:1,name:'Acard',time:'08:00',taken:false,days:[0,1,2,3,4,5,6]},
          {id:2,name:'Metformin',time:'12:00',taken:false,days:[0,1,2,3,4,5,6]},
          {id:3,name:'Amlozek',time:'20:00',taken:false,days:[0,1,2,3,4,5,6]}
        ]);
        setFamilyContacts(savedContacts ? JSON.parse(savedContacts) : [
          {id:1,name:'Anna (c√≥rka)',phone:'+48123456789',avatar:'üë©',app:'whatsapp'},
          {id:2,name:'Piotr (syn)',phone:'+48987654321',avatar:'üë®',app:'viber'},
          {id:3,name:'Dr. Kowalski',phone:'+48555123456',avatar:'üë®‚Äç‚öïÔ∏è',app:''}
        ]);
        setLocalServices(savedServices ? JSON.parse(savedServices) : [
          {id:1,name:'Transport Medyczny',phone:'800123456',icon:'üöë'},
          {id:2,name:'Pomoc Domowa',phone:'800654321',icon:'üè†'},
          {id:3,name:'Apteka z Dowozem',phone:'800789012',icon:'üíä'}
        ]);
        
        if (savedEmergencySettings) {
          const parsedSettings = JSON.parse(savedEmergencySettings);
          // Upewnij siƒô, ≈ºe wszystkie tablice telefon√≥w istniejƒÖ
          setEmergencySettings({
            ...parsedSettings,
            familyPhones: parsedSettings.familyPhones || [],
            medicalPhones: parsedSettings.medicalPhones || [],
            servicesPhones: parsedSettings.servicesPhones || []
          });
        }
      }, []);

      useEffect(() => {
        const handleBeforeInstallPrompt = e => { 
          e.preventDefault(); 
          setDeferredPrompt(e); 
          setShowInstallPrompt(true); 
        };
        window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
        return () => window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
      }, []);

      const handleInstallClick = async () => {
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
          console.log('Aplikacja zainstalowana');
          addNotification('Aplikacja zosta≈Ça zainstalowana pomy≈õlnie!');
        }
        setDeferredPrompt(null); 
        setShowInstallPrompt(false);
      };

      // Zapis ustawie≈Ñ do localStorage
      useEffect(() => { localStorage.setItem('medications', JSON.stringify(medications)); }, [medications]);
      useEffect(() => { localStorage.setItem('familyContacts', JSON.stringify(familyContacts)); }, [familyContacts]);
      useEffect(() => { localStorage.setItem('localServices', JSON.stringify(localServices)); }, [localServices]);
      useEffect(() => { localStorage.setItem('emergencySettings', JSON.stringify(emergencySettings)); }, [emergencySettings]);

      const addNotification = text => {
        const newNotif = { id: Date.now(), text, time: new Date().toLocaleTimeString('pl-PL', {hour:'2-digit',minute:'2-digit'}), read: false };
        setNotifications(prev => [newNotif, ...prev]);
        if ('Notification' in window && Notification.permission === 'granted') new Notification('Senior-Easy', { body: text, icon: 'icon-192.png' });
      };

      useEffect(() => { if ('Notification' in window && Notification.permission === 'default') Notification.requestPermission(); }, []);

      const markMedicationTaken = id => {
        const medication = medications.find(med => med.id === id);
        if (!medication) return;
        
        setMedications(prev => prev.map(med => med.id === id ? { ...med, taken: true } : med));
        
        if (careMode) {
          setSelectedMedication(medication);
          setShowNotifyDialog(true);
        } else {
          addNotification(`Lek "${medication.name}" zosta≈Ç przyjƒôty`);
        }
      };

      const sendNotification = (contactId) => {
        if (!selectedMedication) return;
        
        const contact = familyContacts.find(c => c.id === contactId);
        if (!contact) return;
        
        const message = encodeURIComponent(`‚úÖ Lek "${selectedMedication.name}" zosta≈Ç przyjƒôty o godzinie ${new Date().toLocaleTimeString('pl-PL', {hour:'2-digit', minute:'2-digit'})}`);
        const phone = contact.phone.replace(/[^\d+]/g, '');
        
        if (contact.app === 'whatsapp') {
          window.open(`https://api.whatsapp.com/send?phone=${phone}&text=${message}`, '_blank');
        } else if (contact.app === 'viber') {
          window.open(`viber://forward?text=${message}`, '_blank');
        } else {
          window.location.href = `sms:${phone}?body=${message}`;
        }
        
        addNotification(`Wys≈Çano powiadomienie do ${contact.name}`);
        setShowNotifyDialog(false);
        setSelectedMedication(null);
      };

      const sendToAll = () => {
        if (!selectedMedication) return;
        
        const familyWithApps = familyContacts.filter(c => c.app === 'whatsapp' || c.app === 'viber');
        const message = encodeURIComponent(`‚úÖ Lek "${selectedMedication.name}" zosta≈Ç przyjƒôty o godzinie ${new Date().toLocaleTimeString('pl-PL', {hour:'2-digit', minute:'2-digit'})}`);
        
        familyWithApps.forEach(contact => {
          const phone = contact.phone.replace(/[^\d+]/g, '');
          if (contact.app === 'whatsapp') {
            setTimeout(() => window.open(`https://api.whatsapp.com/send?phone=${phone}&text=${message}`, '_blank'), 100);
          } else if (contact.app === 'viber') {
            setTimeout(() => window.open(`viber://forward?text=${message}`, '_blank'), 100);
          }
        });
        
        addNotification(`Wys≈Çano powiadomienie do ${familyWithApps.length} os√≥b`);
        setShowNotifyDialog(false);
        setSelectedMedication(null);
      };

      // Funkcje awaryjne
      const sendEmergencyMessage = (type) => {
        let message = '';
        let phonesToCall = [];
        
        if (type === 'family') {
          message = encodeURIComponent(emergencySettings.familyMessage);
          phonesToCall = emergencySettings.familyPhones;
        } else if (type === 'medical') {
          message = encodeURIComponent(emergencySettings.medicalMessage);
          phonesToCall = emergencySettings.medicalPhones;
        } else if (type === 'services') {
          message = encodeURIComponent(emergencySettings.servicesMessage);
          phonesToCall = emergencySettings.servicesPhones;
        }
        
        // Wysy≈Çanie do rodziny przez WhatsApp/Viber
        if (type === 'family' || type === 'medical') {
          const familyWithApps = familyContacts.filter(c => c.app === 'whatsapp' || c.app === 'viber');
          
          familyWithApps.forEach(contact => {
            const phone = contact.phone.replace(/[^\d+]/g, '');
            if (contact.app === 'whatsapp') {
              setTimeout(() => window.open(`https://api.whatsapp.com/send?phone=${phone}&text=${message}`, '_blank'), 100);
            } else if (contact.app === 'viber') {
              setTimeout(() => window.open(`viber://forward?text=${message}`, '_blank'), 100);
            }
          });
          
          addNotification(`Wys≈Çano wiadomo≈õƒá awaryjnƒÖ do ${familyWithApps.length} os√≥b`);
        }
        
        // Dzwonienie do numer√≥w alarmowych
        if (phonesToCall.length > 0) {
          const phoneToCall = phonesToCall[0]; // Dzwonimy tylko do pierwszego numeru
          window.location.href = `tel:${phoneToCall}`;
          addNotification(`Dzwoniƒô pod numer: ${phoneToCall}`);
        } else {
          // Domy≈õlny numer alarmowy
          window.location.href = 'tel:112';
          addNotification(`Dzwoniƒô na numer alarmowy 112`);
        }
        
        setShowEmergencyDialog(false);
      };

      // Funkcje do edycji ustawie≈Ñ przycisku awaryjnego
      const updateEmergencySettings = (key, value) => {
        setEmergencySettings(prev => ({
          ...prev,
          [key]: value
        }));
      };

      // Funkcje do zarzƒÖdzania numerami telefon√≥w
      const addPhoneNumber = () => {
        if (!newPhoneNumber.trim()) return;
        
        const phoneKey = `${editingPhoneType}Phones`;
        const updatedPhones = [...emergencySettings[phoneKey], newPhoneNumber.trim()];
        updateEmergencySettings(phoneKey, updatedPhones);
        setNewPhoneNumber('');
      };

      const removePhoneNumber = (index, type) => {
        const phoneKey = `${type}Phones`;
        const updatedPhones = [...emergencySettings[phoneKey]];
        updatedPhones.splice(index, 1);
        updateEmergencySettings(phoneKey, updatedPhones);
      };

      const getEmergencyButtonStyle = () => {
        if (!emergencySettings.enabled) {
          return { display: 'none' };
        }
        
        const baseStyle = {
          width: `${emergencySettings.size}px`,
          height: `${emergencySettings.size}px`,
          fontSize: `${emergencySettings.size * 0.35}px`
        };
        
        // Pozycja
        if (emergencySettings.position === 'bottom-right') {
          baseStyle.bottom = '100px';
          baseStyle.right = '20px';
        } else if (emergencySettings.position === 'bottom-left') {
          baseStyle.bottom = '100px';
          baseStyle.left = '20px';
        } else if (emergencySettings.position === 'top-right') {
          baseStyle.top = '100px';
          baseStyle.right = '20px';
        } else if (emergencySettings.position === 'top-left') {
          baseStyle.top = '100px';
          baseStyle.left = '20px';
        }
        
        // Kolor
        if (emergencySettings.color === 'red') {
          baseStyle.background = 'linear-gradient(to bottom, #ff3333, #cc0000)';
        } else if (emergencySettings.color === 'blue') {
          baseStyle.background = 'linear-gradient(to bottom, #3366ff, #0033cc)';
        } else if (emergencySettings.color === 'orange') {
          baseStyle.background = 'linear-gradient(to bottom, #ff9933, #cc6600)';
        }
        
        // Animacja pulsowania
        if (emergencySettings.pulse) {
          baseStyle.animation = 'pulse 2s infinite';
        } else {
          baseStyle.animation = 'none';
        }
        
        return baseStyle;
      };

      // Funkcje dla dni tygodnia
      const toggleDay = (dayIndex) => {
        if (newMedDays.includes(dayIndex)) {
          setNewMedDays(newMedDays.filter(d => d !== dayIndex));
        } else {
          setNewMedDays([...newMedDays, dayIndex]);
        }
      };

      const selectAllDays = () => {
        setNewMedDays([0, 1, 2, 3, 4, 5, 6]);
      };

      const clearDays = () => {
        setNewMedDays([]);
      };

      const addMedication = () => { 
        if (newMedName && newMedTime && newMedDays.length > 0) { 
          setMedications(prev => [...prev, { 
            id: Date.now(), 
            name: newMedName, 
            time: newMedTime, 
            taken: false,
            days: [...newMedDays]
          }]); 
          setNewMedName(''); 
          setNewMedTime(''); 
          setNewMedDays([]);
        } 
      };

      const deleteMedication = id => setMedications(prev => prev.filter(med => med.id !== id));
      
      const startEditMedication = (medication) => {
        setEditingMedication(medication.id);
        setNewMedName(medication.name);
        setNewMedTime(medication.time);
        setNewMedDays([...medication.days]);
      };

      const saveEditMedication = (id) => {
        setMedications(prev => prev.map(med => 
          med.id === id ? { 
            ...med, 
            name: newMedName, 
            time: newMedTime,
            days: [...newMedDays]
          } : med
        ));
        setEditingMedication(null);
        setNewMedName('');
        setNewMedTime('');
        setNewMedDays([]);
      };

      const cancelEditMedication = () => {
        setEditingMedication(null);
        setNewMedName('');
        setNewMedTime('');
        setNewMedDays([]);
      };

      const makeCall = contact => { if (contact.phone) window.location.href = `tel:${contact.phone}`; if (careMode) addNotification(`Po≈ÇƒÖczenie z ${contact.name}`); };

      const startVideoCall = (contact) => {
        if(!contact) return;
        const phone = contact.phone.replace(/[^\d+]/g,'');
        
        if(contact.app==='whatsapp') {
          window.location.href = `https://api.whatsapp.com/send?phone=${phone}&text=üìπ`;
          setTimeout(() => {
            window.location.href = `whatsapp://send?phone=${phone}`;
          }, 100);
        }
        else if(contact.app==='viber') {
          window.location.href = `viber://contact?number=${phone}`;
        }
        else {
          alert('Brak zdefiniowanej aplikacji wideo. U≈ºywam standardowego po≈ÇƒÖczenia telefonicznego.');
          window.location.href = `tel:${phone}`;
        }
        
        if(careMode) addNotification(`Rozmowa wideo z ${contact.name}`);
      };

      const addContact = () => { if (newContactName && newContactPhone) { setFamilyContacts(prev => [...prev, { id: Date.now(), name: newContactName, phone: newContactPhone, avatar: 'üë§', app: newContactApp }]); setNewContactName(''); setNewContactPhone(''); setNewContactApp(''); } };
      const deleteContact = id => setFamilyContacts(prev => prev.filter(c => c.id !== id));
      const startEditContact = contact => { setEditingContact(contact.id); setNewContactName(contact.name); setNewContactPhone(contact.phone); setNewContactApp(contact.app); };
      const saveEditContact = id => { setFamilyContacts(prev => prev.map(c => c.id === id ? { ...c, name: newContactName, phone: newContactPhone, app: newContactApp } : c)); setEditingContact(null); setNewContactName(''); setNewContactPhone(''); setNewContactApp(''); };
      const cancelEditContact = () => { setEditingContact(null); setNewContactName(''); setNewContactPhone(''); setNewContactApp(''); };
      const addService = () => { if (newServiceName && newServicePhone) { setLocalServices(prev => [...prev, { id: Date.now(), name: newServiceName, phone: newServicePhone, icon: newServiceIcon || 'üè¢' }]); setNewServiceName(''); setNewServicePhone(''); setNewServiceIcon(''); } };
      const deleteService = id => setLocalServices(prev => prev.filter(s => s.id !== id));
      const startEditService = service => { setEditingService(service.id); setNewServiceName(service.name); setNewServicePhone(service.phone); setNewServiceIcon(service.icon); };
      const saveEditService = id => { setLocalServices(prev => prev.map(s => s.id === id ? { ...s, name: newServiceName, phone: newServicePhone, icon: newServiceIcon || 'üè¢' } : s)); setEditingService(null); setNewServiceName(''); setNewServicePhone(''); setNewServiceIcon(''); };
      const cancelEditService = () => { setEditingService(null); setNewServiceName(''); setNewServicePhone(''); setNewServiceIcon(''); };
      const clearData = () => { if (confirm('Czy na pewno chcesz wyczy≈õciƒá wszystkie zapisane dane?')) { localStorage.clear(); setMedications([]); setFamilyContacts([]); setLocalServices([]); setNotifications([]); } };

      return (
        <div>
          {/* Przycisk awaryjny */}
          {emergencySettings.enabled && (
            <button 
              className="emergency-button"
              onClick={() => setShowEmergencyDialog(true)}
              style={getEmergencyButtonStyle()}
            >
              SOS
            </button>
          )}

          {/* Dialog awaryjny */}
          {showEmergencyDialog && (
            <div className="emergency-dialog" onClick={() => setShowEmergencyDialog(false)}>
              <div className="emergency-content" onClick={e => e.stopPropagation()}>
                <h2 className="text-2xl font-bold text-center mb-4 text-red-600">PILNA POMOC</h2>
                <p className="text-center mb-6">Wybierz rodzaj pomocy:</p>
                
                <div className="emergency-option" onClick={() => sendEmergencyMessage('family')}>
                  <div className="emergency-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                  <div className="emergency-text">
                    <div className="emergency-title">Powiadom rodzinƒô</div>
                    <div className="emergency-description">Wy≈õlij wiadomo≈õƒá do rodziny przez WhatsApp/Viber</div>
                  </div>
                </div>
                
                <div className="emergency-option" onClick={() => sendEmergencyMessage('medical')}>
                  <div className="emergency-icon">üöë</div>
                  <div className="emergency-text">
                    <div className="emergency-title">Pomoc medyczna</div>
                    <div className="emergency-description">Powiadom rodzinƒô i zadzwo≈Ñ po pomoc medycznƒÖ</div>
                  </div>
                </div>
                
                <div className="emergency-option" onClick={() => sendEmergencyMessage('services')}>
                  <div className="emergency-icon">üìû</div>
                  <div className="emergency-text">
                    <div className="emergency-title">Zadzwo≈Ñ po pomoc</div>
                    <div className="emergency-description">Zadzwo≈Ñ do lokalnych s≈Çu≈ºb lub numeru alarmowego</div>
                  </div>
                </div>
                
                <button 
                  className="w-full bg-gray-400 hover:bg-gray-500 text-white p-4 rounded-xl font-bold text-lg mt-4"
                  onClick={() => setShowEmergencyDialog(false)}
                >
                  Anuluj
                </button>
              </div>
            </div>
          )}

          {/* Ustawienia przycisku awaryjnego */}
          {showEmergencySettings && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onClick={() => setShowEmergencySettings(false)}>
              <div className="bg-white rounded-3xl shadow-2xl max-w-2xl w-full p-6 md:p-8 max-h-[90vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                <h3 className="text-2xl md:text-3xl font-bold text-center mb-6 text-red-600">
                  Ustawienia Przycisku Awaryjnego
                </h3>
                
                {/* Zak≈Çadki */}
                <div className="flex mb-6 border-b">
                  <button 
                    className={`tab-button ${emergencySettingsTab === 'appearance' ? 'active' : ''}`}
                    onClick={() => setEmergencySettingsTab('appearance')}
                  >
                    WyglƒÖd
                  </button>
                  <button 
                    className={`tab-button ${emergencySettingsTab === 'messages' ? 'active' : ''}`}
                    onClick={() => setEmergencySettingsTab('messages')}
                  >
                    Wiadomo≈õci
                  </button>
                  <button 
                    className={`tab-button ${emergencySettingsTab === 'phones' ? 'active' : ''}`}
                    onClick={() => setEmergencySettingsTab('phones')}
                  >
                    Telefony
                  </button>
                </div>
                
                {emergencySettingsTab === 'appearance' && (
                  <div className="space-y-6">
                    {/* W≈ÇƒÖcz/Wy≈ÇƒÖcz przycisk */}
                    <div className="flex items-center justify-between">
                      <span className="text-xl font-bold">W≈ÇƒÖczony</span>
                      <button 
                        onClick={() => updateEmergencySettings('enabled', !emergencySettings.enabled)}
                        className={`w-16 h-8 rounded-full transition-all ${emergencySettings.enabled ? 'bg-green-500' : 'bg-gray-300'} relative`}
                      >
                        <div className={`w-6 h-6 bg-white rounded-full absolute top-1 transition-all ${emergencySettings.enabled ? 'left-9' : 'left-1'}`}></div>
                      </button>
                    </div>

                    {/* Pozycja przycisku */}
                    <div>
                      <label className="text-xl font-bold mb-2 block">Pozycja przycisku</label>
                      <select 
                        value={emergencySettings.position}
                        onChange={(e) => updateEmergencySettings('position', e.target.value)}
                        className="w-full text-xl p-3 border-2 border-gray-300 rounded-2xl"
                      >
                        <option value="bottom-right">Prawy dolny r√≥g</option>
                        <option value="bottom-left">Lewy dolny r√≥g</option>
                        <option value="top-right">Prawy g√≥rny r√≥g</option>
                        <option value="top-left">Lewy g√≥rny r√≥g</option>
                      </select>
                    </div>

                    {/* Rozmiar przycisku */}
                    <div>
                      <label className="text-xl font-bold mb-2 block">Rozmiar przycisku: {emergencySettings.size}px</label>
                      <input 
                        type="range" 
                        min="50" 
                        max="100" 
                        value={emergencySettings.size}
                        onChange={(e) => updateEmergencySettings('size', parseInt(e.target.value))}
                        className="w-full"
                      />
                    </div>

                    {/* Kolor przycisku */}
                    <div>
                      <label className="text-xl font-bold mb-2 block">Kolor przycisku</label>
                      <div className="flex space-x-4">
                        {['red', 'blue', 'orange'].map(color => (
                          <button
                            key={color}
                            onClick={() => updateEmergencySettings('color', color)}
                            className={`w-12 h-12 rounded-full ${
                              emergencySettings.color === color ? 'ring-4 ring-blue-500' : ''
                            } ${
                              color === 'red' ? 'bg-red-500' : 
                              color === 'blue' ? 'bg-blue-500' : 
                              'bg-orange-500'
                            }`}
                          ></button>
                        ))}
                      </div>
                    </div>

                    {/* Pulsowanie */}
                    <div className="flex items-center justify-between">
                      <span className="text-xl font-bold">Efekt pulsowania</span>
                      <button 
                        onClick={() => updateEmergencySettings('pulse', !emergencySettings.pulse)}
                        className={`w-16 h-8 rounded-full transition-all ${emergencySettings.pulse ? 'bg-green-500' : 'bg-gray-300'} relative`}
                      >
                        <div className={`w-6 h-6 bg-white rounded-full absolute top-1 transition-all ${emergencySettings.pulse ? 'left-9' : 'left-1'}`}></div>
                      </button>
                    </div>
                  </div>
                )}

                {emergencySettingsTab === 'messages' && (
                  <div className="space-y-4">
                    <h4 className="text-lg font-bold">Wiadomo≈õci awaryjne</h4>
                    
                    <div>
                      <label className="text-lg font-bold mb-1 block">Wiadomo≈õƒá dla rodziny</label>
                      <textarea 
                        value={emergencySettings.familyMessage}
                        onChange={(e) => updateEmergencySettings('familyMessage', e.target.value)}
                        className="w-full p-3 border-2 border-gray-300 rounded-2xl"
                        rows="2"
                      />
                    </div>
                    
                    <div>
                      <label className="text-lg font-bold mb-1 block">Wiadomo≈õƒá medyczna</label>
                      <textarea 
                        value={emergencySettings.medicalMessage}
                        onChange={(e) => updateEmergencySettings('medicalMessage', e.target.value)}
                        className="w-full p-3 border-2 border-gray-300 rounded-2xl"
                        rows="2"
                      />
                    </div>
                    
                    <div>
                      <label className="text-lg font-bold mb-1 block">Wiadomo≈õƒá dla s≈Çu≈ºb</label>
                      <textarea 
                        value={emergencySettings.servicesMessage}
                        onChange={(e) => updateEmergencySettings('servicesMessage', e.target.value)}
                        className="w-full p-3 border-2 border-gray-300 rounded-2xl"
                        rows="2"
                      />
                    </div>
                  </div>
                )}

                {emergencySettingsTab === 'phones' && (
                  <div className="space-y-6">
                    <h4 className="text-lg font-bold">Numery telefon√≥w alarmowych</h4>
                    
                    {/* Wyb√≥r typu telefon√≥w */}
                    <div>
                      <label className="text-lg font-bold mb-2 block">Wybierz typ telefon√≥w:</label>
                      <select 
                        value={editingPhoneType}
                        onChange={(e) => setEditingPhoneType(e.target.value)}
                        className="w-full text-xl p-3 border-2 border-gray-300 rounded-2xl"
                      >
                        <option value="family">Rodzina</option>
                        <option value="medical">Medyczne</option>
                        <option value="services">S≈Çu≈ºby</option>
                      </select>
                    </div>

                    {/* Dodawanie nowego numeru */}
                    <div className="flex space-x-2">
                      <input 
                        type="text" 
                        placeholder="Wprowad≈∫ numer telefonu"
                        value={newPhoneNumber}
                        onChange={(e) => setNewPhoneNumber(e.target.value)}
                        className="flex-1 p-3 border-2 border-gray-300 rounded-2xl"
                      />
                      <button 
                        onClick={addPhoneNumber}
                        className="bg-green-500 hover:bg-green-600 text-white p-3 rounded-2xl font-bold"
                      >
                        +
                      </button>
                    </div>

                    {/* Lista numer√≥w */}
                    <div>
                      <label className="text-lg font-bold mb-2 block">
                        {editingPhoneType === 'family' && 'Numery rodziny'}
                        {editingPhoneType === 'medical' && 'Numery medyczne'}
                        {editingPhoneType === 'services' && 'Numery s≈Çu≈ºb'}
                      </label>
                      <div className="phone-list">
                        {emergencySettings[`${editingPhoneType}Phones`]?.length > 0 ? (
                          emergencySettings[`${editingPhoneType}Phones`].map((phone, index) => (
                            <div key={index} className="phone-item">
                              <span className="phone-number">{phone}</span>
                              <button 
                                onClick={() => removePhoneNumber(index, editingPhoneType)}
                                className="bg-red-500 hover:bg-red-600 text-white p-1 rounded text-sm"
                              >
                                Usu≈Ñ
                              </button>
                            </div>
                          ))
                        ) : (
                          <p className="text-gray-500 text-center py-4">Brak zapisanych numer√≥w</p>
                        )}
                      </div>
                    </div>

                    {/* Informacja */}
                    <div className="bg-blue-50 p-4 rounded-2xl">
                      <p className="text-sm text-blue-800">
                        <strong>Uwaga:</strong> W przypadku aktywacji pomocy, aplikacja zadzwoni pod pierwszy numer z listy.
                        Numery sƒÖ wybierane w kolejno≈õci od g√≥ry do do≈Çu.
                      </p>
                    </div>
                  </div>
                )}

                <button 
                  onClick={() => setShowEmergencySettings(false)}
                  className="w-full bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-2xl font-bold text-xl mt-6"
                >
                  Zapisz i zamknij
                </button>
              </div>
            </div>
          )}

          {showNotifyDialog && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onClick={() => setShowNotifyDialog(false)}>
              <div className="bg-white rounded-3xl shadow-2xl max-w-2xl w-full p-6 md:p-8 max-h-[90vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                <h3 className="text-2xl md:text-3xl font-bold text-center mb-4 text-green-600">
                  ‚úÖ Lek przyjƒôty!
                </h3>
                <p className="text-xl md:text-2xl text-center mb-6 text-gray-700">
                  Kogo chcesz powiadomiƒá o przyjƒôciu leku<br/><strong>"{selectedMedication?.name}"</strong>?
                </p>
                
                <div className="space-y-3 mb-6">
                  {familyContacts.filter(c => c.app === 'whatsapp' || c.app === 'viber').map(contact => (
                    <button 
                      key={contact.id}
                      onClick={() => sendNotification(contact.id)}
                      className="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 active:from-green-700 active:to-green-800 text-white p-4 md:p-6 rounded-2xl shadow-lg flex items-center space-x-4 transition-all transform hover:scale-105"
                    >
                      <span className="text-4xl md:text-5xl">{contact.avatar}</span>
                      <div className="flex-1 text-left">
                        <div className="text-xl md:text-2xl font-bold">{contact.name}</div>
                        <div className="text-base md:text-lg opacity-90">
                          {contact.app === 'whatsapp' ? 'üì± WhatsApp' : 'üí¨ Viber'}
                        </div>
                      </div>
                      <span className="text-3xl md:text-4xl">‚úâÔ∏è</span>
                    </button>
                  ))}
                </div>

                {familyContacts.filter(c => c.app === 'whatsapp' || c.app === 'viber').length > 1 && (
                  <button 
                    onClick={sendToAll}
                    className="w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 active:from-blue-700 active:to-blue-800 text-white p-4 md:p-6 rounded-2xl shadow-lg font-bold text-xl md:text-2xl mb-4 transition-all transform hover:scale-105"
                  >
                    üì¢ Wy≈õlij do wszystkich
                  </button>
                )}

                <button 
                  onClick={() => { setShowNotifyDialog(false); setSelectedMedication(null); }}
                  className="w-full bg-gray-400 hover:bg-gray-500 active:bg-gray-600 text-white p-4 md:p-5 rounded-2xl font-bold text-xl md:text-2xl transition-colors"
                >
                  ‚ùå Nie wysy≈Çaj
                </button>

                {familyContacts.filter(c => c.app === 'whatsapp' || c.app === 'viber').length === 0 && (
                  <div className="bg-yellow-50 border-4 border-yellow-400 p-6 rounded-2xl text-center">
                    <p className="text-xl md:text-2xl font-bold text-yellow-800 mb-2">‚ö†Ô∏è Brak kontakt√≥w</p>
                    <p className="text-lg md:text-xl text-yellow-700">
                      Dodaj cz≈Çonk√≥w rodziny z WhatsApp lub Viber w zak≈Çadce "Rodzina"
                    </p>
                  </div>
                )}
              </div>
            </div>
          )}
          {showInstallPrompt && (
            <div className="install-prompt bg-blue-600 text-white p-4 rounded-2xl shadow-2xl max-w-md">
              <div className="flex items-center justify-between">
                <div className="flex-1">
                  <p className="text-lg font-bold">Zainstaluj Senior-Easy</p>
                  <p className="text-sm">U≈ºywaj aplikacji jak natywnej!</p>
                </div>
                <div className="flex space-x-2">
                  <button onClick={handleInstallClick} className="bg-white text-blue-600 px-4 py-2 rounded-xl font-bold">Instaluj</button>
                  <button onClick={() => setShowInstallPrompt(false)} className="bg-blue-700 px-4 py-2 rounded-xl">P√≥≈∫niej</button>
                </div>
              </div>
            </div>
          )}
          <div className="bg-white rounded-2xl sm:rounded-3xl shadow-2xl p-3 sm:p-4 mb-4 sm:mb-6 flex justify-between items-center">
            <button onClick={() => setCurrentScreen('home')} className="bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white p-2 sm:p-4 rounded-xl sm:rounded-2xl transition-colors"><span className="text-3xl sm:text-5xl">üè†</span></button>
            <div className="text-lg sm:text-2xl md:text-3xl font-bold text-gray-800 px-2 text-center">{currentScreen==='home'?'Strona G≈Ç√≥wna':currentScreen==='video'?'Rozmowa Wideo':currentScreen==='medications'?'Leki':currentScreen==='contacts'?'Rodzina':currentScreen==='services'?'Us≈Çugi':currentScreen==='notifications'?'Powiadomienia':'Ustawienia'}</div>
            <button onClick={() => setCurrentScreen('settings')} className="bg-gray-500 hover:bg-gray-600 active:bg-gray-700 text-white p-2 sm:p-4 rounded-xl sm:rounded-2xl transition-colors"><span className="text-3xl sm:text-5xl">‚öôÔ∏è</span></button>
          </div>
          <div className="bg-white rounded-2xl sm:rounded-3xl shadow-2xl p-4 sm:p-6 md:p-8">
            {currentScreen==='home' && (
              <div className="space-y-4 sm:space-y-6 text-center">
                <h1 className="text-3xl sm:text-4xl md:text-5xl font-bold text-blue-600 mb-2">Senior-Easy</h1>
                <p className="text-lg sm:text-xl md:text-2xl text-gray-600 mb-4">Witaj! Co chcesz zrobiƒá?</p>
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 md:gap-6">
                  <button onClick={()=>setCurrentScreen('video')} className="bg-green-500 hover:bg-green-600 active:bg-green-700 text-white p-6 sm:p-6 md:p-8 rounded-2xl sm:rounded-3xl shadow-2xl flex flex-col items-center justify-center space-y-2 sm:space-y-3 md:space-y-4 transition-colors min-h-[140px] sm:min-h-[160px]"><span className="text-4xl sm:text-5xl">üìπ</span><span className="text-xl sm:text-2xl md:text-3xl font-bold">Rozmowa Wideo</span></button>
                  <button onClick={()=>setCurrentScreen('medications')} className="bg-purple-500 hover:bg-purple-600 active:bg-purple-700 text-white p-6 sm:p-6 md:p-8 rounded-2xl sm:rounded-3xl shadow-2xl flex flex-col items-center justify-center space-y-2 sm:space-y-3 md:space-y-4 transition-colors min-h-[140px] sm:min-h-[160px]"><span className="text-4xl sm:text-5xl">üíä</span><span className="text-xl sm:text-2xl md:text-3xl font-bold">Leki</span></button>
                  <button onClick={()=>setCurrentScreen('contacts')} className="bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white p-6 sm:p-6 md:p-8 rounded-2xl sm:rounded-3xl shadow-2xl flex flex-col items-center justify-center space-y-2 sm:space-y-3 md:space-y-4 transition-colors min-h-[140px] sm:min-h-[160px]"><span className="text-4xl sm:text-5xl">üìû</span><span className="text-xl sm:text-2xl md:text-3xl font-bold">Rodzina</span></button>
                  <button onClick={()=>setCurrentScreen('services')} className="bg-orange-500 hover:bg-orange-600 active:bg-orange-700 text-white p-6 sm:p-6 md:p-8 rounded-2xl sm:rounded-3xl shadow-2xl flex flex-col items-center justify-center space-y-2 sm:space-y-3 md:space-y-4 transition-colors min-h-[140px] sm:min-h-[160px]"><span className="text-4xl sm:text-5xl">üìç</span><span className="text-xl sm:text-2xl md:text-3xl font-bold">Us≈Çugi</span></button>
                </div>
              </div>
            )}
            {currentScreen==='video' && (
              <div className="space-y-4 md:space-y-6">
                <h2 className="text-3xl md:text-4xl font-bold text-center mb-6 md:mb-8">Rozmowa Wideo</h2>
                {familyContacts.map(c=>(
                  <button key={c.id} onClick={()=>startVideoCall(c)} className="w-full bg-white hover:bg-green-50 active:bg-green-100 border-4 border-green-500 p-6 md:p-8 rounded-3xl shadow-xl flex items-center space-x-4 md:space-x-6 mb-4 transition-colors">
                    <span className="text-5xl md:text-6xl">{c.avatar}</span>
                    <div className="flex-1 text-left"><div className="text-2xl md:text-3xl font-bold text-gray-800">{c.name}</div><div className="text-lg md:text-xl text-gray-500">{c.phone}</div><div className="text-base md:text-lg text-gray-400">{c.app?`(${c.app})`:''}</div></div>
                    <span className="text-4xl md:text-5xl">üìπ</span>
                  </button>
                ))}
              </div>
            )}
            {currentScreen==='medications' && (
              <div className="space-y-4 md:space-y-6">
                <h2 className="text-3xl md:text-4xl font-bold text-center mb-6 md:mb-8">Przypomnienia o Lekach</h2>
                {medications.map(med=>(
                  <div key={med.id} className={`bg-white border-4 p-4 md:p-6 rounded-3xl shadow-xl flex items-center justify-between ${med.taken?'border-gray-300 opacity-60':'border-purple-500'}`}>
                    {editingMedication === med.id ? (
                      <div className="w-full space-y-4">
                        <input type="text" placeholder="Nazwa leku" value={newMedName} onChange={e=>setNewMedName(e.target.value)} className="w-full text-xl md:text-2xl p-3 md:p-4 border-2 border-gray-300 rounded-2xl"/>
                        <input type="time" value={newMedTime} onChange={e=>setNewMedTime(e.target.value)} className="w-full text-xl md:text-2xl p-3 md:p-4 border-2 border-gray-300 rounded-2xl"/>
                        
                        <div className="flex flex-col space-y-3">
                          <div className="flex justify-between">
                            <span className="text-lg font-bold">Dni przyjmowania:</span>
                            <div className="flex space-x-2">
                              <button onClick={selectAllDays} className="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-sm">Wszystkie</button>
                              <button onClick={clearDays} className="bg-gray-500 hover:bg-gray-600 text-white px-2 py-1 rounded text-sm">Wyczy≈õƒá</button>
                            </div>
                          </div>
                          <div className="flex justify-between">
                            {weekdays.map((day, index) => (
                              <button 
                                key={index}
                                onClick={() => toggleDay(index)}
                                className={`weekday-button ${newMedDays.includes(index) ? 'selected' : ''}`}
                              >
                                {day}
                              </button>
                            ))}
                          </div>
                        </div>
                        
                        <div className="flex space-x-3">
                          <button onClick={() => saveEditMedication(med.id)} className="flex-1 bg-green-500 hover:bg-green-600 text-white p-3 rounded-2xl font-bold">üíæ Zapisz</button>
                          <button onClick={cancelEditMedication} className="flex-1 bg-gray-500 hover:bg-gray-600 text-white p-3 rounded-2xl font-bold">‚ùå Anuluj</button>
                        </div>
                      </div>
                    ) : (
                      <>
                        <div className="flex-1">
                          <div className="text-2xl md:text-3xl font-bold text-gray-800">{med.name}</div>
                          <div className="text-xl md:text-2xl text-gray-600">Godzina: {med.time}</div>
                          <div className="mt-2">
                            <div className="text-lg text-gray-500">Dni:</div>
                            <div className="flex space-x-1">
                              {weekdays.map((day, index) => (
                                <span 
                                  key={index} 
                                  className={`text-sm ${med.days.includes(index) ? 'font-bold text-purple-600' : 'text-gray-400'}`}
                                >
                                  {day}
                                </span>
                              ))}
                            </div>
                          </div>
                        </div>
                        <div className="flex space-x-2 md:space-x-3">
                          {!med.taken ? (
                            <button onClick={()=>markMedicationTaken(med.id)} className="bg-green-500 hover:bg-green-600 active:bg-green-700 text-white p-3 md:p-4 rounded-2xl transition-colors text-2xl">‚úÖ</button>
                          ) : (
                            <div className="bg-gray-300 text-white p-3 md:p-4 rounded-2xl text-2xl">‚úÖ</div>
                          )}
                          <button onClick={()=>startEditMedication(med)} className="bg-yellow-500 hover:bg-yellow-600 active:bg-yellow-700 text-white p-3 md:p-4 rounded-2xl transition-colors text-2xl">‚úèÔ∏è</button>
                          <button onClick={()=>deleteMedication(med.id)} className="bg-red-500 hover:bg-red-600 active:bg-red-700 text-white p-3 md:p-4 rounded-2xl transition-colors text-2xl">üóëÔ∏è</button>
                        </div>
                      </>
                    )}
                  </div>
                ))}
                <div className="bg-blue-50 border-4 border-blue-300 p-4 md:p-6 rounded-3xl space-y-4">
                  <h3 className="text-xl md:text-2xl font-bold text-center">Dodaj Nowy Lek</h3>
                  <input type="text" placeholder="Nazwa leku" value={newMedName} onChange={e=>setNewMedName(e.target.value)} className="w-full text-xl md:text-2xl p-3 md:p-4 border-2 border-gray-300 rounded-2xl"/>
                  <input type="time" value={newMedTime} onChange={e=>setNewMedTime(e.target.value)} className="w-full text-xl md:text-2xl p-3 md:p-4 border-2 border-gray-300 rounded-2xl"/>
                  
                  <div className="flex flex-col space-y-3">
                    <div className="flex justify-between">
                      <span className="text-lg font-bold">Dni przyjmowania:</span>
                      <div className="flex space-x-2">
                        <button onClick={selectAllDays} className="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-sm">Wszystkie</button>
                        <button onClick={clearDays} className="bg-gray-500 hover:bg-gray-600 text-white px-2 py-1 rounded text-sm">Wyczy≈õƒá</button>
                      </div>
                    </div>
                    <div className="flex justify-between">
                      {weekdays.map((day, index) => (
                        <button 
                          key={index}
                          onClick={() => toggleDay(index)}
                          className={`weekday-button ${newMedDays.includes(index) ? 'selected' : ''}`}
                        >
                          {day}
                        </button>
                      ))}
                    </div>
                  </div>
                  
                  <button onClick={addMedication} className="w-full bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white text-xl md:text-2xl font-bold p-3 md:p-4 rounded-2xl transition-colors">‚ûï Dodaj</button>
                </div>
              </div>
            )}
            {currentScreen==='contacts' && (
              <div className="space-y-4 md:space-y-6">
                <h2 className="text-3xl md:text-4xl font-bold text-center mb-6 md:mb-8">Kontakty Rodzinne</h2>
                {familyContacts.map(c=>(
                  <div key={c.id} className="bg-white border-4 border-blue-500 p-4 md:p-6 rounded-3xl shadow-xl mb-4">
                    {editingContact === c.id ? (
                      <div className="space-y-4">
                        <input type="text" placeholder="Imiƒô i nazwisko" value={newContactName} onChange={e=>setNewContactName(e.target.value)} className="w-full text-xl md:text-2xl p-3 md:p-4 border-2 border-gray-300 rounded-2xl"/>
                        <input type="tel" placeholder="Numer telefonu z +48" value={newContactPhone} onChange={e=>setNewContactPhone(e.target.value)} className="w-full text-xl md:text-2xl p-3 md:p-4 border-2 border-gray-300 rounded-2xl"/>
                        <select value={newContactApp} onChange={e=>setNewContactApp(e.target.value)} className="w-full text-xl md:text-2xl p-3 md:p-4 border-2 border-gray-300 rounded-2xl"><option value="">Brak aplikacji</option><option value="whatsapp">WhatsApp</option><option value="viber">Viber</option></select>
                        <div className="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3"><button onClick={()=>saveEditContact(c.id)} className="flex-1 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white p-3 md:p-4 rounded-2xl transition-colors text-lg">üíæ Zapisz</button><button onClick={cancelEditContact} className="flex-1 bg-gray-500 hover:bg-gray-600 active:bg-gray-700 text-white p-3 md:p-4 rounded-2xl transition-colors text-lg">‚ùå Anuluj</button></div>
                      </div>
                    ) : (
                      <>
                        <div className="flex items-center space-x-4 md:space-x-6 mb-4"><span className="text-5xl md:text-6xl">{c.avatar}</span><div className="flex-1"><div className="text-2xl md:text-3xl font-bold text-gray-800">{c.name}</div><div className="text-lg md:text-xl text-gray-500">{c.phone}</div><div className="text-base md:text-lg text-gray-400">{c.app?`(${c.app})`:''}</div></div></div>
                        <div className="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3"><button onClick={()=>makeCall(c)} className="flex-1 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white p-3 md:p-4 rounded-2xl flex items-center justify-center transition-colors text-lg">üìû Zadzwo≈Ñ</button><button onClick={()=>startVideoCall(c)} className="flex-1 bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white p-3 md:p-4 rounded-2xl flex items-center justify-center transition-colors text-lg">üé• Wideo</button></div>
                        <div className="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3 mt-3"><button onClick={()=>startEditContact(c)} className="flex-1 bg-yellow-500 hover:bg-yellow-600 active:bg-yellow-700 text-white p-3 md:p-4 rounded-2xl transition-colors text-lg">‚úèÔ∏è Edytuj</button><button onClick={()=>deleteContact(c.id)} className="flex-1 bg-red-500 hover:bg-red-600 active:bg-red-700 text-white p-3 md:p-4 rounded-2xl transition-colors text-lg">üóëÔ∏è Usu≈Ñ</button></div>
                      </>
                    )}
                  </div>
                ))}
                <div className="bg-blue-50 border-4 border-blue-300 p-4 md:p-6 rounded-3xl space-y-4">
                  <h3 className="text-xl md:text-2xl font-bold text-center">Dodaj Kontakt</h3>
                  <input type="text" placeholder="Imiƒô i nazwisko" value={newContactName} onChange={e=>setNewContactName(e.target.value)} className="w-full text-xl md:text-2xl p-3 md:p-4 border-2 border-gray-300 rounded-2xl"/>
                  <input type="tel" placeholder="Numer telefonu z +48" value={newContactPhone} onChange={e=>setNewContactPhone(e.target.value)} className="w-full text-xl md:text-2xl p-3 md:p-4 border-2 border-gray-300 rounded-2xl"/>
                  <select value={newContactApp} onChange={e=>setNewContactApp(e.target.value)} className="w-full text-xl md:text-2xl p-3 md:p-4 border-2 border-gray-300 rounded-2xl"><option value="">Brak aplikacji</option><option value="whatsapp">WhatsApp</option><option value="viber">Viber</option></select>
                  <button onClick={addContact} className="w-full bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white text-xl md:text-2xl font-bold p-3 md:p-4 rounded-2xl transition-colors">‚ûï Dodaj Kontakt</button>
                </div>
              </div>
            )}
            {currentScreen==='services' && (
              <div className="space-y-4 md:space-y-6">
                <h2 className="text-3xl md:text-4xl font-bold text-center mb-6 md:mb-8">Lokalne Us≈Çugi</h2>
                {localServices.map(s=>(
                  <div key={s.id} className="bg-white border-4 border-orange-500 p-4 md:p-6 rounded-3xl shadow-xl mb-4">
                    {editingService === s.id ? (
                      <div className="space-y-4">
                        <input type="text" placeholder="Nazwa" value={newServiceName} onChange={e=>setNewServiceName(e.target.value)} className="w-full text-xl md:text-2xl p-3 md:p-4 border-2 border-gray-300 rounded-2xl"/>
                        <input type="tel" placeholder="Telefon" value={newServicePhone} onChange={e=>setNewServicePhone(e.target.value)} className="w-full text-xl md:text-2xl p-3 md:p-4 border-2 border-gray-300 rounded-2xl"/>
                        <input type="text" placeholder="Emoji/Ikona" value={newServiceIcon} onChange={e=>setNewServiceIcon(e.target.value)} className="w-full text-xl md:text-2xl p-3 md:p-4 border-2 border-gray-300 rounded-2xl"/>
                        <div className="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3"><button onClick={()=>saveEditService(s.id)} className="flex-1 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white p-3 md:p-4 rounded-2xl transition-colors text-lg">üíæ Zapisz</button><button onClick={cancelEditService} className="flex-1 bg-gray-500 hover:bg-gray-600 active:bg-gray-700 text-white p-3 md:p-4 rounded-2xl transition-colors text-lg">‚ùå Anuluj</button></div>
                      </div>
                    ) : (
                      <>
                        <div className="flex items-center space-x-4 md:space-x-6 mb-4"><span className="text-5xl md:text-6xl">{s.icon}</span><div className="flex-1 text-left"><div className="text-2xl md:text-3xl font-bold text-gray-800">{s.name}</div><div className="text-lg md:text-xl text-gray-500">{s.phone}</div></div></div>
                        <div className="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3"><button onClick={()=>makeCall(s)} className="flex-1 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white p-3 md:p-4 rounded-2xl flex items-center justify-center transition-colors text-lg">üìû Zadzwo≈Ñ</button></div>
                        <div className="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3 mt-3"><button onClick={()=>startEditService(s)} className="flex-1 bg-yellow-500 hover:bg-yellow-600 active:bg-yellow-700 text-white p-3 md:p-4 rounded-2xl transition-colors text-lg">‚úèÔ∏è Edytuj</button><button onClick={()=>deleteService(s.id)} className="flex-1 bg-red-500 hover:bg-red-600 active:bg-red-700 text-white p-3 md:p-4 rounded-2xl transition-colors text-lg">üóëÔ∏è Usu≈Ñ</button></div>
                      </>
                    )}
                  </div>
                ))}
                <div className="bg-orange-50 border-4 border-orange-300 p-4 md:p-6 rounded-3xl space-y-4">
                  <h3 className="text-xl md:text-2xl font-bold text-center">Dodaj Us≈Çugƒô</h3>
                  <input type="text" placeholder="Nazwa" value={newServiceName} onChange={e=>setNewServiceName(e.target.value)} className="w-full text-xl md:text-2xl p-3 md:p-4 border-2 border-gray-300 rounded-2xl"/>
                  <input type="tel" placeholder="Telefon" value={newServicePhone} onChange={e=>setNewServicePhone(e.target.value)} className="w-full text-xl md:text-2xl p-3 md:p-4 border-2 border-gray-300 rounded-2xl"/>
                  <input type="text" placeholder="Emoji/Ikona" value={newServiceIcon} onChange={e=>setNewServiceIcon(e.target.value)} className="w-full text-xl md:text-2xl p-3 md:p-4 border-2 border-gray-300 rounded-2xl"/>
                  <button onClick={addService} className="w-full bg-orange-500 hover:bg-orange-600 active:bg-orange-700 text-white text-xl md:text-2xl font-bold p-3 md:p-4 rounded-2xl transition-colors">‚ûï Dodaj Us≈Çugƒô</button>
                </div>
              </div>
            )}
            {currentScreen==='settings' && (
              <div className="space-y-6">
                <h2 className="text-3xl md:text-4xl font-bold text-center mb-6 md:mb-8">Ustawienia</h2>
                
                {/* Tryb opieki rodzinnej */}
                <div className="bg-white border-4 border-blue-500 p-6 md:p-8 rounded-3xl shadow-xl">
                  <div className="flex items-center justify-between mb-6">
                    <div className="flex-1 pr-4">
                      <div className="text-2xl md:text-3xl font-bold text-gray-800">Tryb Opieki Rodzinnej</div>
                      <div className="text-lg md:text-xl text-gray-600 mt-2">Rodzina otrzymuje powiadomienia</div>
                    </div>
                    <button onClick={()=>setCareMode(!careMode)} className={`w-24 md:w-32 h-12 md:h-16 rounded-full transition-all ${careMode?'bg-green-500':'bg-gray-300'} relative flex-shrink-0`}>
                      <div className={`w-8 md:w-12 h-8 md:h-12 bg-white rounded-full absolute top-2 transition-all ${careMode?'left-12 md:left-16':'left-2'}`}></div>
                    </button>
                  </div>
                  <div className="text-lg md:text-xl text-gray-600 bg-blue-50 p-4 rounded-2xl">
                    {careMode?'‚úì Tryb aktywny - rodzina jest informowana':'‚úó Tryb wy≈ÇƒÖczony'}
                  </div>
                </div>

                {/* Ustawienia przycisku awaryjnego */}
                <div className="bg-white border-4 border-red-500 p-6 md:p-8 rounded-3xl shadow-xl">
                  <div className="flex items-center justify-between mb-6">
                    <div className="flex-1 pr-4">
                      <div className="text-2xl md:text-3xl font-bold text-gray-800">Przycisk Awaryjny</div>
                      <div className="text-lg md:text-xl text-gray-600 mt-2">Dostosuj wyglƒÖd, wiadomo≈õci i telefony alarmowe</div>
                    </div>
                    <button 
                      onClick={() => setShowEmergencySettings(true)}
                      className="bg-red-500 hover:bg-red-600 text-white p-4 rounded-2xl font-bold text-lg"
                    >
                      Konfiguruj
                    </button>
                  </div>
                  <div className="text-lg md:text-xl text-gray-600 bg-red-50 p-4 rounded-2xl">
                    {emergencySettings.enabled ? '‚úì Przycisk aktywny' : '‚úó Przycisk wy≈ÇƒÖczony'} | 
                    Rozmiar: {emergencySettings.size}px | 
                    Kolor: {emergencySettings.color === 'red' ? 'Czerwony' : emergencySettings.color === 'blue' ? 'Niebieski' : 'Pomara≈Ñczowy'}
                  </div>
                </div>

                {/* Instalacja aplikacji */}
                <div className="bg-white border-4 border-green-500 p-6 md:p-8 rounded-3xl shadow-xl">
                  <div className="flex items-center justify-between mb-6">
                    <div className="flex-1 pr-4">
                      <div className="text-2xl md:text-3xl font-bold text-gray-800">Instalacja Aplikacji</div>
                      <div className="text-lg md:text-xl text-gray-600 mt-2">Zainstaluj aplikacjƒô na swoim urzƒÖdzeniu</div>
                    </div>
                    <button 
                      onClick={handleInstallClick}
                      className="bg-green-500 hover:bg-green-600 text-white p-4 rounded-2xl font-bold text-lg"
                    >
                      Zainstaluj
                    </button>
                  </div>
                  <div className="text-lg md:text-xl text-gray-600 bg-green-50 p-4 rounded-2xl">
                    Zainstaluj Senior-Easy na swoim urzƒÖdzeniu, aby korzystaƒá z aplikacji jak z natywnej!
                  </div>
                </div>

                {/* Wyczy≈õƒá wszystkie dane */}
                <div className="bg-white border-4 border-red-500 p-6 md:p-8 rounded-3xl shadow-xl">
                  <div className="flex items-center justify-between mb-6">
                    <div className="flex-1 pr-4">
                      <div className="text-2xl md:text-3xl font-bold text-gray-800">Wyczy≈õƒá wszystkie dane</div>
                      <div className="text-lg md:text-xl text-gray-600 mt-2">Usu≈Ñ wszystkie zapisane leki, kontakty i ustawienia</div>
                    </div>
                    <button 
                      onClick={clearData}
                      className="bg-red-500 hover:bg-red-600 text-white p-4 rounded-2xl font-bold text-lg"
                    >
                      Wyczy≈õƒá
                    </button>
                  </div>
                  <div className="text-lg md:text-xl text-gray-600 bg-red-50 p-4 rounded-2xl">
                    Uwaga: Ta operacja jest nieodwracalna! Wszystkie dane zostanƒÖ trwale usuniƒôte.
                  </div>
                </div>

                {/* Informacje o aplikacji */}
                <div className="bg-purple-50 border-4 border-purple-300 p-6 md:p-8 rounded-3xl">
                  <h3 className="text-2xl md:text-3xl font-bold text-center mb-4">Informacje o Aplikacji</h3>
                  <div className="space-y-3 text-lg md:text-xl text-gray-700">
                    <p><strong>Wersja:</strong> 2.0 PWA</p>
                    <p><strong>Typ:</strong> Progressive Web App</p>
                    <p><strong>Wsparcie:</strong> +480 800 800</p>
                    <p className="text-base md:text-lg text-gray-600 mt-4">
                      Aplikacja dzia≈Ça offline i mo≈ºe byƒá zainstalowana na urzƒÖdzeniu mobilnym lub komputerze.
                    </p>
                  </div>
                </div>
              </div>
            )}
          </div>
          <div className="text-center mt-6 text-gray-600 text-lg md:text-xl"><p>Senior-Easy ¬© 2025 | Pomoc: +480 800 800</p></div>
        </div>
      );
    }

    if ('serviceWorker' in navigator) window.addEventListener('load', () => navigator.serviceWorker.register('service-worker.js').then(r => console.log('SW registered:', r)).catch(err => console.log('SW registration failed:', err)));
    ReactDOM.createRoot(document.getElementById('root')).render(<SeniorEasyApp />);
  </script>
</body>
</html>
